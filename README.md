# LinuxC
[TOC]



## 1. 文件IO基础

## 2. 深入文件IO

## 3. 标准IO

#### 文件内核缓冲

​	read()、write()系统调用一般在进行文件读写操作时，不直接访问磁盘，而是在用户缓冲区和内核缓冲区之间复制数据。内核缓冲区叫做文件IO内核缓冲，可提高文件IO的速度和效率，因为磁盘操作很缓慢。这样就不需要频繁让内核操作磁盘了。

​	但是，在一些场景下，比如将文件copy到U盘，文件copy完成拔掉U盘之前，需要执行sync命令进行同步操作，存储到磁盘。

#### 刷新文件IO内核缓冲区

​	**控制IO内核缓冲的函数**：系统调用（fsync对目标文件进行同步、fdatasync进行同步数据、sync将所有文件的所有信息同步），频繁调用这些函数对性能影响极大。	

​	**控制IO内核缓冲的标志**：O_DSYNC和O_SYNC标志

```c
fd = open(filepath, O_WRONLY|O_DSYNC); // 效果类似于调用write后，调用了fdatasync函数，进行数据同步
fd = open(filepath, O_WRONLY|O_SYNC); // 效果类似于调用write后，调用了fsync函数，将文件内容数据和元数据进行同步
```



#### **直接IO绕过内核缓冲**

​	从用户空间直接将数据传递到文件或磁盘设备。某些操作会使用，如一些程序需要测试磁盘的读写速率，这就需要read和write直接访问磁盘设备，不经过内核缓冲。然而，直接IO可能会大大降低性能，因为为了提高IO性能，内核针对IO内核缓冲区做了很多优化，若直接IO，无法享受到这些优化措施带来性能的提升。

#### StdioIO缓冲

C 语言提供了一些库函数可用于对标准 I/O 的 stdio 缓冲区进行相关的一些设置， 包括 setbuf()、setbuffer()以及 setvbuf()

## 术语

1. 元数据：指的是记录文件属性相关的信息，如文件大小，时间戳，权限等信息。

